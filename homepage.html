<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dollarsurvey | Home</title>

  <style>
    :root{
      --bg:#000;
      --accent:#adff2f;
      --muted:rgba(173,255,47,0.08);
      --glass: rgba(173,255,47,0.04);
      --card-shadow: 0 6px 30px rgba(173,255,47,0.06);
      --radius:14px;
      --radius-sm:8px;
      --maxwidth:980px;
      --gap:14px;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--accent);
      display:flex;
      justify-content:center;
      padding:24px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      width:100%;
      max-width:var(--maxwidth);
    }

    /* HEADER */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo{
      display:inline-flex;
      width:64px;
      height:64px;
      background:linear-gradient(180deg, rgba(173,255,47,0.12), rgba(173,255,47,0.04));
      border-radius:12px;
      border:1px solid rgba(173,255,47,0.18);
      align-items:center;
      justify-content:center;
      text-decoration:none;
      color:var(--accent);
      font-weight:700;
      font-size:20px;
    }

    .title{
      font-size:18px;
      line-height:1;
      font-weight:700;
      letter-spacing:0.2px;
    }

    .meta{
      display:flex;
      gap:10px;
      align-items:center;
      font-size:14px;
    }

    .meta .id, .meta .balance{
      background:var(--glass);
      padding:8px 12px;
      border-radius:10px;
      border:1px solid rgba(173,255,47,0.07);
      box-shadow:var(--card-shadow);
      color:var(--accent);
      font-weight:600;
    }

    /* menu top-right */
    .menu-btn{
      background:transparent;
      border:1px solid rgba(173,255,47,0.12);
      color:var(--accent);
      padding:8px 12px;
      border-radius:999px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      cursor:pointer;
    }

    nav.menu{
      display:none;
      position:absolute;
      right:20px;
      top:82px;
      background:rgba(0,0,0,0.9);
      border:1px solid rgba(173,255,47,0.06);
      padding:10px;
      border-radius:10px;
      min-width:160px;
      z-index:80;
    }

    nav.menu a{
      display:block;
      padding:8px 10px;
      color:var(--accent);
      text-decoration:none;
      border-radius:8px;
      font-size:14px;
    }
    nav.menu a:hover{background:rgba(173,255,47,0.04);}

    /* SURVEYS AREA */
    main{
      margin-top:6px;
    }

    .surveys-heading{
      font-size:26px;
      font-weight:900;
      margin:8px 0 14px 0;
      color:var(--accent);
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:var(--gap);
    }

    .card{
      background:linear-gradient(180deg, rgba(173,255,47,0.02), rgba(173,255,47,0.01));
      border-radius:var(--radius);
      padding:14px;
      border:1px solid rgba(173,255,47,0.06);
      box-shadow:var(--card-shadow);
    }

    .question{
      font-size:15px;
      line-height:1.4;
      margin-bottom:10px;
      color:var(--accent);
    }

    textarea.answer{
      width:100%;
      min-height:72px;
      resize:vertical;
      padding:10px;
      border-radius:10px;
      background:transparent;
      border:1px dashed rgba(173,255,47,0.14);
      color:var(--accent);
      outline:none;
      font-size:14px;
    }

    .card-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:8px;
      gap:10px;
    }

    .share-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:8px;
      border:1px solid rgba(173,255,47,0.08);
      background:transparent;
      cursor:pointer;
      color:var(--accent);
      font-size:14px;
    }

    .submit-row{
      display:flex;
      gap:12px;
      align-items:center;
      margin-top:18px;
      flex-wrap:wrap;
    }

    button.primary{
      background:var(--accent);
      color:#000;
      border:none;
      padding:12px 16px;
      border-radius:10px;
      cursor:pointer;
      font-weight:800;
    }
    button.ghost{
      background:transparent;
      border:1px solid rgba(173,255,47,0.12);
      padding:10px 12px;
      border-radius:10px;
      color:var(--accent);
      cursor:pointer;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:22px;
      background:rgba(0,0,0,0.88);
      border:1px solid rgba(173,255,47,0.07);
      color:var(--accent);
      padding:12px 16px;
      border-radius:12px;
      box-shadow:var(--card-shadow);
      display:none;
      z-index:999;
      font-weight:700;
    }

    /* responsive */
    @media(min-width:720px){
      .grid{grid-template-columns:1fr 1fr;}
    }
    @media(min-width:980px){
      .grid{grid-template-columns:1fr 1fr;}
      header{align-items:center;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <a class="logo" href="#" aria-label="Dollarsurvey logo">DS</a>
        <div>
          <div class="title">Welcome to Dollarsurvey</div>
          <div style="font-size:13px; opacity:0.85;">Answer surveys & earn</div>
        </div>
      </div>

      <div class="meta" id="metaArea">
        <div class="id" id="userId">ID: ---</div>
        <div class="balance" id="balance">$0.00</div>
        <button class="menu-btn" id="menuBtn">☰ Menu</button>
      </div>

      <!-- floating menu (hidden by default) -->
      <nav class="menu" id="menuPanel" aria-hidden="true">
        <a href="homepage.html">Home</a>
        <a href="profile.html">Profile</a>
        <a href="faq.html">FAQ</a>
        <a href="terms&privacy.html">Terms & Privacy</a>
        <a href="login.html" id="signOutLink">Sign out</a>
      </nav>
    </header>

    <main>
      <h1 class="surveys-heading">We have got some surveys for you</h1>

      <form id="surveysForm">
        <div class="grid" id="questionsGrid">
          <!-- Survey cards will be injected here -->
        </div>

        <div class="submit-row">
          <button type="button" class="primary" id="submitBtn">Submit all answers</button>
          <button type="button" class="ghost" id="clearBtn">Clear answers</button>
          <div style="flex:1"></div>
        </div>
      </form>
    </main>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Firebase SDK and App logic -->
  <script type="module">
    // Firebase (based on your provided config)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-analytics.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
    import {
      getDatabase,
      ref,
      set,
      update,
      get,
      child,
      push,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

    // YOUR firebaseConfig (from your snippet)
    const firebaseConfig = {
      apiKey: "AIzaSyDnq2364tMuRPbrjjHmUfFUTjWZC2BmIS4",
      authDomain: "dollar-survey-60fe7.firebaseapp.com",
      projectId: "dollar-survey-60fe7",
      storageBucket: "dollar-survey-60fe7.firebasestorage.app",
      messagingSenderId: "293471697208",
      appId: "1:293471697208:web:664863f09e830e420c69cd",
      measurementId: "G-RCZ7SQJHPZ"
    };

    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(e){ /* analytics optional */ }

    const auth = getAuth(app);
    const db = getDatabase(app);

    // UI refs
    const questionsGrid = document.getElementById('questionsGrid');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const toast = document.getElementById('toast');
    const menuBtn = document.getElementById('menuBtn');
    const menuPanel = document.getElementById('menuPanel');
    const signOutLink = document.getElementById('signOutLink');
    const userIdEl = document.getElementById('userId');
    const balanceEl = document.getElementById('balance');

    // Toggle menu
    menuBtn.addEventListener('click', () => {
      const open = menuPanel.style.display === 'block';
      menuPanel.style.display = open ? 'none' : 'block';
      menuPanel.setAttribute('aria-hidden', open ? 'true' : 'false');
    });

    // Custom toast
    function showToast(msg, opts = {}) {
      toast.style.display = 'block';
      toast.style.background = opts.bg || 'rgba(0,0,0,0.88)';
      toast.style.color = opts.color || 'var(--accent)';
      toast.textContent = msg;
      setTimeout(()=> {
        toast.style.display = 'none';
      }, opts.timeout || 3000);
    }

    // Example: 10 AdSense-safe ~50-word surveys (consumer preference situational)
    // Each question includes a small situational prompt and asks for a short typed answer (>=5 chars)
    const SURVEYS = [
`You’re shopping for a new smartphone for everyday use. Which top three features matter most to you (e.g., battery life, camera, durability) and why would you pick them over price or brand?`,
`Imagine you need a compact kitchen appliance that saves time. Which appliance would you choose for a busy weeknight routine and describe a typical use-case where it helps?`,
`Consider a pair of headphones for commuting. What type (in-ear, over-ear, true wireless) would you select and explain the one characteristic that seals your choice?`,
`You want to upgrade your home lighting for ambiance. Which type of bulb or fixture would you pick and how would it improve your daily living or mood?`,
`For personal fitness, would you prefer smart wearable tracking or a simple analog tracker; explain which metrics you care about and why they matter to you.`,
`When buying a laptop for study/work-from-home, which single spec (battery, weight, screen, CPU) would you prioritize and how does it affect your daily tasks?`,
`If you pick a streaming service subscription, which content or feature convinces you to keep it month-to-month and why is that more important than price?`,
`Select a type of coffee maker for a small household and describe your ideal routine and how the machine fits into that morning ritual.`,
`You’re choosing between eco-friendly household cleaners and regular brands. What makes you choose eco-friendly products and in what situations do you switch?`,
`When selecting a travel bag for weekend trips, what qualities (size, pockets, comfort) are non-negotiable and narrate a short scenario where those qualities help.`
    ];

    // Render survey cards
    function renderSurveys(){
      questionsGrid.innerHTML = '';
      SURVEYS.forEach((q, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="question"><strong>Q${idx+1}.</strong> ${q}</div>
          <textarea id="ans_${idx}" class="answer" minlength="5" placeholder="Type your answer (min 5 characters)"></textarea>
          <div class="card-footer">
            <div style="font-size:13px; opacity:0.9;">Answer length must be at least 5 characters.</div>
            <button type="button" class="share-btn" data-index="${idx}">↗ Share</button>
          </div>
        `;
        questionsGrid.appendChild(card);
      });

      // attach share handlers
      document.querySelectorAll('.share-btn').forEach(btn=>{
        btn.addEventListener('click', async (e)=>{
          const url = window.location.origin + window.location.pathname; // homepage link
          try {
            if (navigator.share) {
              await navigator.share({ title: 'Dollarsurvey', text: 'Check out Dollarsurvey!', url });
              showToast('Shared successfully');
            } else {
              await navigator.clipboard.writeText(url);
              showToast('Homepage link copied to clipboard');
            }
          } catch(err){
            showToast('Could not share link', {timeout:2500});
          }
        });
      });
    }

    renderSurveys();

    // Clear answers
    clearBtn.addEventListener('click', ()=>{
      SURVEYS.forEach((_,i)=>{
        const ta = document.getElementById(`ans_${i}`);
        if (ta) ta.value = '';
      });
      showToast('Answers cleared');
    });

    // Sign out behavior
    signOutLink.addEventListener('click', async (e)=>{
      e.preventDefault();
      try {
        await signOut(auth);
        window.location.href = 'login.html';
      } catch(err){
        showToast('Sign out failed');
      }
    });

    // Submission logic
    submitBtn.addEventListener('click', async ()=> {
      // validate user logged in
      const user = auth.currentUser;
      if (!user) {
        showToast('You must be logged in to submit', { timeout: 3000 });
        setTimeout(()=> window.location.href = 'login.html', 800);
        return;
      }

      // collect answers & validate min length 5 and not empty
      const answers = [];
      for (let i=0;i<SURVEYS.length;i++){
        const ta = document.getElementById(`ans_${i}`);
        const v = ta?.value?.trim() || '';
        if (v.length < 5) {
          showToast(`Please answer Q${i+1} with at least 5 characters`, { timeout: 3000 });
          ta.focus();
          return;
        }
        answers.push({ qIndex: i+1, question: SURVEYS[i], answer: v });
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      try {
        const uid = user.uid;
        const userRef = ref(db, `users/${uid}`);

        // store answers under user submissions with push()
        const submissionsRef = ref(db, `users/${uid}/submissions`);
        const newSubRef = push(submissionsRef);
        const submissionData = {
          answers,
          timestamp: Date.now()
        };
        await set(newSubRef, submissionData);

        // Update balance: add $0.5
        const snap = await get(child(ref(db), `users/${uid}/balance`));
        let current = 0;
        if (snap && snap.exists()) {
          const val = snap.val();
          current = Number(val) || 0;
        }
        const updated = (Math.round((current + 0.5) * 100)/100);
        await set(ref(db, `users/${uid}/balance`), updated);

        showToast('Submission saved. +$0.50 added to your balance!', { timeout: 2000 });

        // clear answers
        SURVEYS.forEach((_,i)=>{
          const ta = document.getElementById(`ans_${i}`);
          if (ta) ta.value = '';
        });

        // ensure UI updates before reload
        balanceEl.textContent = `$${updated.toFixed(2)}`;

        // refresh automatically after brief pause (per requirement)
        setTimeout(()=> {
          window.location.reload();
        }, 1000);

      } catch (err) {
        console.error(err);
        showToast('Submission failed. Try again.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit all answers';
      }
    });

    // Auth state: update UI with email-based user ID and balance load
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        // redirect to login if not signed in
        showToast('Redirecting to login...', { timeout: 1200 });
        setTimeout(()=> window.location.href = 'login.html', 900);
        return;
      }
      // User present
      const email = user.email || '';
      const idText = email.slice(0,5) || user.uid.slice(0,5);
      userIdEl.textContent = `ID: ${idText}`;

      // load balance from DB
      try {
        const balSnap = await get(child(ref(db), `users/${user.uid}/balance`));
        let current = 0;
        if (balSnap && balSnap.exists()) current = Number(balSnap.val()) || 0;
        balanceEl.textContent = `$${(Math.round(current*100)/100).toFixed(2)}`;
      } catch (e) {
        balanceEl.textContent = '$0.00';
      }
    });

    // close menu when clicking outside
    document.addEventListener('click', (e)=>{
      if (!menuPanel.contains(e.target) && !menuBtn.contains(e.target)) {
        menuPanel.style.display = 'none';
      }
    });

    // Accessibility: disable form enter-submission to avoid partial submits
    document.getElementById('surveysForm').addEventListener('submit', (e)=> e.preventDefault());

  </script>
</body>
</html>
